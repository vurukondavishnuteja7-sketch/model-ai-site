<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Model AI Assistant</title>

  <style>
    body{
      margin:0;
      font-family:Arial, sans-serif;
      background:#0f172a;
      color:white;
    }

    .center{
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
    }

    #loginBox{
      background:#1e293b;
      padding:30px;
      border-radius:12px;
      text-align:center;
      box-shadow:0 0 20px #000;
    }

    button{
      padding:10px 16px;
      margin:6px;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-weight:bold;
    }

    .google{background:#ef4444;color:white;}
    .email{background:#3b82f6;color:white;}
    .logout{background:#22c55e;color:white;}

    #chatUI{display:none;height:100vh;flex-direction:column;}

    .header{
      background:#020617;
      padding:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid #334155;
    }

    .chatBox{
      flex:1;
      overflow-y:auto;
      padding:20px;
    }

    .msg{
      margin:10px 0;
      padding:12px;
      border-radius:10px;
      max-width:70%;
    }

    .user{background:#22c55e;margin-left:auto;}
    .bot{background:#1e293b;}

    .inputArea{
      display:flex;
      padding:10px;
      background:#020617;
      border-top:1px solid #334155;
    }

    input{
      flex:1;
      padding:12px;
      border-radius:8px;
      border:none;
      outline:none;
    }

    .send{background:#22c55e;color:white;}
  </style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" class="center">
  <div>
    <h2>Login to Model AI</h2>
    <button class="google" onclick="googleLogin()">Google Login</button><br>
    <button class="email" onclick="emailLogin()">Email Login</button><br>
    <button class="email" onclick="emailSignup()">Sign Up</button>
  </div>
</div>

<!-- CHAT UI -->
<div id="chatUI">
  <div class="header">
    <h3>Model AI Assistant</h3>
    <button class="logout" onclick="logout()">Logout</button>
  </div>

  <div class="chatBox" id="chatBox"></div>

  <div class="inputArea">
    <input id="msgInput" placeholder="Ask anything or type: image cat" />
    <button class="send" onclick="sendMsg()">Send</button>
  </div>
</div>

<!-- FIREBASE + CHAT SCRIPT -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  signInWithPopup,
  signInWithEmailAndPassword,
  createUserWithEmailAndPassword,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDUcWSbU-ELP7Erx9yGPbq65clsn2ME8pk",
  authDomain: "model-ai-727b1.firebaseapp.com",
  projectId: "model-ai-727b1",
  storageBucket: "model-ai-727b1.firebasestorage.app",
  messagingSenderId: "970799402645",
  appId: "1:970799402645:web:4e2a93dbacbfd6ee97d59c"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

window.googleLogin = async () => {
  try { await signInWithPopup(auth, provider); }
  catch(e){ alert(e.message); }
};

window.emailLogin = async () => {
  const email = prompt("Enter email");
  const pass = prompt("Enter password");
  await signInWithEmailAndPassword(auth, email, pass);
};

window.emailSignup = async () => {
  const email = prompt("Create email");
  const pass = prompt("Create password");
  await createUserWithEmailAndPassword(auth, email, pass);
};

window.logout = () => signOut(auth);

onAuthStateChanged(auth, user => {
  document.getElementById("loginBox").style.display = user ? "none" : "flex";
  document.getElementById("chatUI").style.display = user ? "flex" : "none";
});

// CHAT FUNCTION
window.sendMsg = async () => {
  const input = document.getElementById("msgInput");
  const chat = document.getElementById("chatBox");

  const text = input.value.trim();
  if(!text) return;

  chat.innerHTML += `<div class="msg user">${text}</div>`;
  input.value="";

  const res = await fetch("/api/chat",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:text})
  });

  const data = await res.json();

  chat.innerHTML += `<div class="msg bot">${data.reply}</div>`;
  chat.scrollTop = chat.scrollHeight;
};

</script>

</body>
</html>
