<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Model AI</title>

<style>
body{margin:0;font-family:Arial;background:#f7f7f8;display:flex;height:100vh}
.sidebar{width:250px;background:#fff;border-right:1px solid #ddd;padding:10px}
.main{flex:1;display:flex;flex-direction:column}
.chat{flex:1;overflow:auto;padding:20px}
.input{display:flex;border-top:1px solid #ddd;padding:10px}
input{flex:1;padding:10px}
button{padding:10px 15px;margin-left:5px}
.msg{margin:10px 0}
.user{text-align:right}
img{max-width:200px;border-radius:10px;margin-top:5px}
.login{position:fixed;inset:0;background:#0008;display:flex;align-items:center;justify-content:center}
.login-box{background:#fff;padding:20px;border-radius:10px;text-align:center}
</style>
</head>

<body>

<div class="sidebar">
<h3>Model AI</h3>
<button onclick="logout()">Logout</button>
</div>

<div class="main">
<div id="chat" class="chat"></div>

<div class="input">
<input id="q" placeholder="Ask anything or type: image cat"/>
<button onclick="ask()">Send</button>
</div>
</div>

<!-- LOGIN SCREEN -->
<div id="login" class="login" style="display:none">
<div class="login-box">
<h2>Login</h2>
<button onclick="googleLogin()">Google Login</button><br><br>
<button onclick="emailLogin()">Email Login</button><br><br>
<button onclick="emailSignup()">Sign Up</button>
</div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDUcWSbU-ELP7Erx9yGPbq65clsn2ME8pk",
  authDomain: "model-ai-727b1.firebaseapp.com",
  projectId: "model-ai-727b1",
  storageBucket: "model-ai-727b1.firebasestorage.app",
  messagingSenderId: "970799402645",
  appId: "1:970799402645:web:4e2a93dbacbfd6ee97d59c",
  measurementId: "G-0EW8BHNTH3"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

/* GOOGLE LOGIN */
async function googleLogin(){
  const provider=new firebase.auth.GoogleAuthProvider();
  await auth.signInWithPopup(provider);
}

/* EMAIL LOGIN */
async function emailLogin(){
  const email=prompt("Email:");
  const pass=prompt("Password:");
  await auth.signInWithEmailAndPassword(email,pass);
}

/* SIGNUP */
async function emailSignup(){
  const email=prompt("Create Email:");
  const pass=prompt("Create Password:");
  await auth.createUserWithEmailAndPassword(email,pass);
}

/* LOGOUT */
async function logout(){
  await auth.signOut();
}

/* AUTO LOGIN CHECK */
auth.onAuthStateChanged(user=>{
  document.getElementById("login").style.display = user ? "none" : "flex";
});

/* CHAT */
const chat=document.getElementById("chat");

function add(text,type){
  const d=document.createElement("div");
  d.className="msg "+type;
  d.innerText=text;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

async function ask(){
  const q=document.getElementById("q");
  const msg=q.value.trim();
  if(!msg) return;

  add(msg,"user");
  q.value="";

  /* IMAGE MODE */
  if(msg.toLowerCase().startsWith("image")){
    const img=document.createElement("img");
    img.src=`https://image.pollinations.ai/prompt/${encodeURIComponent(msg)}`;
    chat.appendChild(img);
    return;
  }

  add("Thinking...");

  const res=await fetch("/api/chat",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:msg})
  });

  const data=await res.json();
  chat.lastChild.remove();
  add(data.reply || "Error");
}
</script>

</body>
</html>
