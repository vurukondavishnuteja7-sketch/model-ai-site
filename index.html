<script>
async function ask(){
  const q = document.getElementById("q").value;
  if(!q) return;

  addMessage(q, "user");
  saveHistory(q);
  document.getElementById("q").value = "";

 // MULTI IMAGE GENERATION FIXED
if(q.toLowerCase().startsWith("image of")){
  const prompt = q.replace("image of","").trim();

  const wrap = document.createElement("div");
  wrap.className = "msg bot";

  const bubble = document.createElement("div");
  bubble.className = "bubble";
  bubble.innerText = "Generated images:";
  wrap.appendChild(bubble);

  // create 4 images with delay-free stable URLs
  for(let i=0;i<4;i++){
    const img = document.createElement("img");
    img.src = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=512&height=512&seed=${i+1}`;
    img.className = "ai-image";

    // if image fails → hide broken icon
    img.onerror = () => img.style.display = "none";

    wrap.appendChild(img);
  }

  chat.appendChild(wrap);
  chat.scrollTop = chat.scrollHeight;
  return;
}


  // ✅ TEXT AI
  addMessage("Thinking...", "bot");

  const res = await fetch("/api/chat",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ message:q })
  });

  const data = await res.json();
  chat.lastChild.remove();
  addMessage(data.reply || "Error", "bot");
}
</script>
