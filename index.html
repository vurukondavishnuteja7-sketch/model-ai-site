<script>
async function ask(){
  const q = document.getElementById("q").value;
  if(!q) return;

  addMessage(q, "user");
  saveHistory(q);
  document.getElementById("q").value = "";

  // ✅ MULTI IMAGE GENERATION
  if(q.toLowerCase().startsWith("image of")){
    const prompt = q.replace("image of","").trim();

    const wrap = document.createElement("div");
    wrap.className = "msg bot";

    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.innerText = "Generated images:";
    wrap.appendChild(bubble);

    // create 4 images
    for(let i=0;i<4;i++){
      const img = document.createElement("img");
      img.src = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?seed=${Math.random()}`;
      img.className = "ai-image";
      wrap.appendChild(img);
    }

    document.getElementById("chat").appendChild(wrap);
    document.getElementById("chat").scrollTop = chat.scrollHeight;
    return;
  }

  // ✅ TEXT AI
  addMessage("Thinking...", "bot");

  const res = await fetch("/api/chat",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ message:q })
  });

  const data = await res.json();
  chat.lastChild.remove();
  addMessage(data.reply || "Error", "bot");
}
</script>
