<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model AI</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}

body{display:flex;height:100vh;background:#f7f7f8}

/* SIDEBAR */
.sidebar{
  width:260px;background:#fff;border-right:1px solid #e5e7eb;
  padding:16px;display:flex;flex-direction:column;gap:12px
}
.btn{border:none;padding:12px;border-radius:10px;font-weight:600;cursor:pointer}
.new{background:#10a37f;color:#fff}
.logout{background:#ef4444;color:#fff}

/* MAIN */
.main{flex:1;display:flex;flex-direction:column}

/* HEADER */
.header{
  height:60px;background:#fff;border-bottom:1px solid #e5e7eb;
  display:flex;align-items:center;padding:0 20px;font-weight:600
}

/* MESSAGES */
.messages{
  flex:1;overflow-y:auto;padding:24px;
  display:flex;flex-direction:column;gap:16px
}
.msg{max-width:70%;padding:12px 16px;border-radius:14px;line-height:1.5}
.user{background:#10a37f;color:#fff;align-self:flex-end}
.ai{background:#fff;border:1px solid #e5e7eb}

/* IMAGE */
.preview{max-width:200px;border-radius:10px;margin-top:6px}

/* INPUT */
.input-area{
  border-top:1px solid #e5e7eb;background:#fff;
  padding:12px;display:flex;gap:10px;align-items:center
}
.input-area input[type="text"]{
  flex:1;padding:12px;border-radius:12px;border:1px solid #d1d5db
}
.icon-btn{background:#f1f5f9;border:none;padding:10px;border-radius:10px;cursor:pointer}
.send{background:#10a37f;color:#fff}

/* LOGIN SCREEN */
#loginScreen{
  position:fixed;inset:0;background:#f7f7f8;
  display:flex;align-items:center;justify-content:center
}
.login-box{
  background:#fff;padding:30px;border-radius:14px;
  width:280px;text-align:center;border:1px solid #e5e7eb
}
.login-box button{width:100%;margin-top:10px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-box">
    <h2>Login to Model AI</h2>
    <button class="btn new" onclick="login()">Enter App</button>
  </div>
</div>

<!-- SIDEBAR -->
<div class="sidebar">
  <button class="btn new" onclick="newChat()">+ New chat</button>
  <button class="btn logout" onclick="logout()">Logout</button>
</div>

<!-- MAIN -->
<div class="main">
  <div class="header">Model AI Assistant</div>

  <div id="messages" class="messages"></div>

  <div class="input-area">
    <input type="file" id="img" hidden accept="image/*">
    <button class="icon-btn" onclick="img.click()">ðŸ“Ž</button>

    <input id="text" type="text" placeholder="Send a message..." />
    <button class="btn send" onclick="send()">Send</button>
  </div>
</div>

<script>
const messages=document.getElementById("messages");
const text=document.getElementById("text");
const img=document.getElementById("img");

let imageFile=null;

/* LOGIN */
function login(){
  localStorage.setItem("modelai_login","yes");
  document.getElementById("loginScreen").style.display="none";
}
if(localStorage.getItem("modelai_login")==="yes"){
  document.getElementById("loginScreen").style.display="none";
}

/* LOGOUT */
function logout(){
  localStorage.removeItem("modelai_login");
  location.reload();
}

/* IMAGE SELECT */
img.onchange=()=>imageFile=img.files[0];

/* SEND */
async function send(){
  const textVal=text.value.trim();
  if(!textVal && !imageFile) return;

  const user=document.createElement("div");
  user.className="msg user";
  user.innerText=textVal;
  messages.appendChild(user);

  if(imageFile){
    const im=document.createElement("img");
    im.src=URL.createObjectURL(imageFile);
    im.className="preview";
    user.appendChild(im);
  }

  text.value="";

  const ai=document.createElement("div");
  ai.className="msg ai";
  ai.innerText="Thinking...";
  messages.appendChild(ai);
  messages.scrollTop=messages.scrollHeight;

  try{
    const res=await fetch("/api/chat",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:textVal})
    });
    const data=await res.json();
    ai.innerText=data.reply || "No response";
  }catch{
    ai.innerText="AI error";
  }

  imageFile=null;
  img.value="";
}

/* NEW CHAT */
function newChat(){messages.innerHTML="";}
</script>

</body>
</html>
